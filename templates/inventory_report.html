{% extends "base.html" %}
{% block content %}
  <h1 class="page-title">Weekly Inventory Report</h1>
  <p class="page-sub">Detailed usage analysis and cost breakdown</p>

  <form method="get" style="margin-bottom:20px;">
    <div style="display:flex;gap:12px;align-items:flex-end;">
      <div>
        <label style="font-weight:700;margin-bottom:6px;display:block;">Start Date</label>
        <input type="date" name="start_date" value="{{ start_date }}" style="padding:10px;border:1px solid #e5e7eb;border-radius:10px;">
      </div>
      <div>
        <label style="font-weight:700;margin-bottom:6px;display:block;">End Date</label>
        <input type="date" name="end_date" value="{{ end_date }}" style="padding:10px;border:1px solid #e5e7eb;border-radius:10px;">
      </div>
      <button type="submit" class="btn dark">Generate Report</button>
      <a href="{{ url_for('inventory_page') }}" class="btn gray">Back to Inventory</a>
    </div>
  </form>

  <h2 style="margin:26px 0 12px;">Summary by Usage Type</h2>
  <div class="grid cols-3">
    {% for sum in summary %}
    <div class="card kpi">
      <div class="label">{{ sum.usage_type }}</div>
      <div class="value">${{ "%.2f"|format(sum.type_total_cost or 0) }}</div>
      <div class="hint">{{ sum.ingredient_count }} ingredients</div>
    </div>
    {% endfor %}
  </div>

  <h2 style="margin:26px 0 12px;">Detailed Usage Report</h2>
  {% for item in usage_data %}
  <div class="row" style="margin-top:12px;">
    <div class="row-left">
      <div>
        <div class="row-title">{{ item.name }}</div>
        <div class="row-sub">{{ item.usage_type }} - {{ item.usage_count }} transactions</div>
      </div>
    </div>
    <div class="row-right">
      <div style="font-weight:800;">${{ "%.2f"|format(item.total_cost or 0) }}</div>
      <div style="font-size:13px;color:var(--muted);">{{ item.total_used }} {{ item.unit }}</div>
    </div>
  </div>
  {% endfor %}

  {% if usage_data|length == 0 %}
  <div class="card pad">
    <b>No usage data found for this period.</b>
  </div>
  {% endif %}
{% endblock %}
